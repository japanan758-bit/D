<?php

namespace App\Http\Controllers;

use Illuminate\Http\Request;
use Illuminate\Support\Facades\Http;
use Illuminate\Support\Facades\Log;
use Illuminate\Support\Facades\Cache;

class ChatBotController extends Controller
{
    // ØªÙƒÙˆÙŠÙ† Ø§Ù„Ù€ APIs Ø§Ù„Ù…Ø®ØªÙ„ÙØ©
    private array $apiConfigs = [
        'gpt4' => [
            'endpoint' => 'https://api.openai.com/v1/chat/completions',
            'model' => 'gpt-4',
            'api_key' => env('OPENAI_API_KEY'),
            'pricing' => 'Ù…Ø¯ÙÙˆØ¹',
            'name' => 'GPT-4'
        ],
        'claude' => [
            'endpoint' => 'https://api.anthropic.com/v1/messages',
            'model' => 'claude-3-sonnet-20240229',
            'api_key' => env('ANTHROPIC_API_KEY'),
            'pricing' => 'Ù…Ø¯ÙÙˆØ¹',
            'name' => 'Claude'
        ],
        'gemini' => [
            'endpoint' => 'https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent',
            'model' => 'gemini-pro',
            'api_key' => env('GOOGLE_AI_API_KEY'),
            'pricing' => 'Ù…Ø¯ÙÙˆØ¹',
            'name' => 'Gemini'
        ],
        'openrouter' => [
            'endpoint' => 'https://openrouter.ai/api/v1/chat/completions',
            'model' => 'anthropic/claude-3-haiku', // Default model
            'api_key' => env('OPENROUTER_API_KEY'),
            'pricing' => 'Ù…Ø¬Ø§Ù†ÙŠ/Ù…Ø¯ÙÙˆØ¹',
            'name' => 'OpenRouter'
        ]
    ];

    // Ø±Ø¯ÙˆØ¯ Ø°ÙƒÙŠØ© Ù…Ø­Ù„ÙŠØ© (Ù…ÙØ­Ø³Ù†Ø©)
    private function getAdvancedLocalResponse(string $input): string
    {
        $input = strtolower($input);
        
        // Ù‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø¹Ø±ÙØ© Ù…Ø­Ø³Ù†Ø©
        $knowledgeBase = [
            'Ø­Ø¬Ø²' => [
                'keywords' => ['Ø­Ø¬Ø²', 'Ù…ÙˆØ¹Ø¯', 'Ù…ÙˆØ§Ø¹ÙŠØ¯', 'ÙƒØªØ§Ø¨'],
                'response' => "ðŸ“… **Ø­Ø¬Ø² Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ù…ØªØ§Ø­Ø©:**\n\nðŸ• **Ø§Ù„Ø£ÙˆÙ‚Ø§Øª Ø§Ù„Ù…ØªÙˆÙØ±Ø©:**\nâ€¢ Ø§Ù„Ø£Ø­Ø¯: 9:00 Øµ - 12:00 Øµ | 2:00 Ù… - 5:00 Ù…\nâ€¢ Ø§Ù„Ø§Ø«Ù†ÙŠÙ†: 9:00 Øµ - 12:00 Øµ | 2:00 Ù… - 6:00 Ù…\nâ€¢ Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡: 9:00 Øµ - 12:00 Øµ | 2:00 Ù… - 6:00 Ù…\nâ€¢ Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡: 9:00 Øµ - 12:00 Øµ | 2:00 Ù… - 6:00 Ù…\nâ€¢ Ø§Ù„Ø®Ù…ÙŠØ³: 9:00 Øµ - 12:00 Øµ | 2:00 Ù… - 6:00 Ù…\nâ€¢ Ø§Ù„Ø¬Ù…Ø¹Ø©: 9:00 Øµ - 12:00 Øµ\n\nðŸ’¡ **Ù†ØµØ§Ø¦Ø­ Ù„Ù„Ø­Ø¬Ø²:**\nâ€¢ Ø§Ø­Ø¬Ø² Ù…ÙˆØ¹Ø¯Ø§Ù‹ Ù…Ø¨ÙƒØ±Ø§Ù‹ Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ ÙˆÙ‚Øª Ù…Ù†Ø§Ø³Ø¨\nâ€¢ Ù„Ù„ÙØ­ÙˆØµØ§Øª Ø§Ù„Ø¯ÙˆØ±ÙŠØ©: Ø§Ø­Ø¬Ø² Ø£ÙˆÙ„ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹\nâ€¢ Ù„Ù„Ø·ÙˆØ§Ø±Ø¦: Ø§ØªØµÙ„ Ù…Ø¨Ø§Ø´Ø±Ø©: +966 11 234 5678\n\nðŸŽ¯ **Ø·Ø±Ù‚ Ø§Ù„Ø­Ø¬Ø²:**\n1. Ø­Ø¬Ø² Ø£ÙˆÙ†Ù„Ø§ÙŠÙ† Ù…Ù† Ø§Ù„Ù…ÙˆÙ‚Ø¹\n2. Ø§ØªØµØ§Ù„ Ù…Ø¨Ø§Ø´Ø±\n3. ÙˆØ§ØªØ³Ø§Ø¨\n4. ØªØ·Ø¨ÙŠÙ‚ Ù‡ÙˆØ§\n\n*Ù…Ù„Ø§Ø­Ø¸Ø©: Ø§Ù„Ø­Ø¬Ø² Ø£ÙˆÙ†Ù„Ø§ÙŠÙ† Ù…ØªØ§Ø­ 24/7*\n\nÙ‡Ù„ ØªØ±ÙŠØ¯ Ø§Ù„Ø­Ø¬Ø² Ø§Ù„Ø¢Ù†ØŸ ðŸ˜Š"
            ],
            'Ø³Ø¹Ø±' => [
                'keywords' => ['Ø³Ø¹Ø±', 'ØªÙƒÙ„ÙØ©', 'Ù‚ÙŠÙ…Ø©', 'ÙÙ„ÙˆØ³', 'ÙƒÙ„ÙØ©'],
                'response' => "ðŸ’° **ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø£Ø³Ø¹Ø§Ø± ÙˆØ§Ù„Ø®Ø¯Ù…Ø§Øª:**\n\nðŸ©º **Ø§Ù„Ø§Ø³ØªØ´Ø§Ø±Ø§Øª:**\nâ€¢ ÙØ­Øµ Ø´Ø§Ù…Ù„ Ù„Ù„Ø¹ÙŠÙˆÙ†: **200 Ø±ÙŠØ§Ù„**\nâ€¢ Ø§Ø³ØªØ´Ø§Ø±Ø© Ø´Ø¨ÙƒÙŠØ© Ù…ØªØ®ØµØµØ©: **300 Ø±ÙŠØ§Ù„**\nâ€¢ ÙØ­Øµ Ø¶ØºØ· Ø§Ù„Ø¹ÙŠÙ†: **150 Ø±ÙŠØ§Ù„**\nâ€¢ ÙØ­Øµ Ù‚Ø§Ø¹ Ø§Ù„Ø¹ÙŠÙ†: **200 Ø±ÙŠØ§Ù„**\nâ€¢ ÙØ­Øµ Ø§Ù„Ù†Ø¸Ø± ÙˆØ§Ù„Ø§Ù†ÙƒØ³Ø§Ø±: **120 Ø±ÙŠØ§Ù„**\nâ€¢ ÙØ­Øµ Ù‚ÙˆØ³ Ø§Ù„Ù‚Ø±Ù†ÙŠØ©: **180 Ø±ÙŠØ§Ù„**\n\nðŸ¥ **Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª:**\nâ€¢ Ø¬Ø±Ø§Ø­Ø© Ø§Ù„Ù…ÙŠØ§Ù‡ Ø§Ù„Ø¨ÙŠØ¶Ø§Ø¡ (Ø§Ù„ÙØ§ÙƒÙˆ): **4,500 Ø±ÙŠØ§Ù„**\nâ€¢ Ø²Ø±Ø¹ Ø§Ù„Ø¹Ø¯Ø³Ø© Ù…ØªØ¹Ø¯Ø¯Ø© Ø§Ù„Ø¨Ø¤Ø±Ø©: **+1,500 Ø±ÙŠØ§Ù„**\nâ€¢ Ø²Ø±Ø¹ Ø¹Ø¯Ø³Ø© TORIC: **+1,000 Ø±ÙŠØ§Ù„**\nâ€¢ Ù„ÙŠØ²Ø± Ø§Ù„Ø´Ø¨ÙƒÙŠØ©: **800 Ø±ÙŠØ§Ù„**\nâ€¢ Ø¬Ø±Ø§Ø­Ø© Ø§Ù„Ø¬Ù„ÙˆÙƒÙˆÙ…Ø§: **6,000 Ø±ÙŠØ§Ù„**\nâ€¢ Ø¬Ø±Ø§Ø­Ø© Ø§Ù†ÙØµØ§Ù„ Ø§Ù„Ø´Ø¨ÙƒÙŠØ©: **8,000 Ø±ÙŠØ§Ù„**\n\nðŸŽ **Ø¹Ø±ÙˆØ¶ Ø®Ø§ØµØ©:**\nâ€¢ ÙØ­Øµ Ù…Ø¬Ø§Ù†ÙŠ Ù„Ù„Ù…Ø¹Ø§Ù„Ø¬ÙŠÙ†: **Ø§Ù„Ù…Ø±Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰ ÙÙ‚Ø·**\nâ€¢ Ø®ØµÙ… 10% Ù„Ù„Ø­ÙˆØ§Ù…Ù„ ÙˆØ§Ù„Ø±Ø¶Ø¹\nâ€¢ ØªØ£Ù…ÙŠÙ† Ø·Ø¨ÙŠ Ù…ØªÙˆÙØ±\n\nðŸ’³ **Ø·Ø±Ù‚ Ø§Ù„Ø¯ÙØ¹:**\nâ€¢ Ù†Ù‚Ø¯Ø§Ù‹ â€¢ Ø¨Ø·Ø§Ù‚Ø© â€¢ ØªÙ‚Ø³ÙŠØ·\nâ€¢ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨Ù†ÙˆÙƒ Ù…Ø¹ØªÙ…Ø¯Ø©\n\nÙ‡Ù„ ØªØ±ÙŠØ¯ Ø§Ù„ØªÙØ§ØµÙŠÙ„ Ø¹Ù† Ø®Ø¯Ù…Ø© Ù…Ø¹ÙŠÙ†Ø©ØŸ ðŸ¤”"
            ],
            'Ø´Ø¨ÙƒÙŠØ©' => [
                'keywords' => ['Ø´Ø¨ÙƒÙŠØ©', 'Ø§Ù†ÙØµØ§Ù„', 'ØªÙ„ÙŠÙ', 'Ø§Ù„ÙˆØ§Ø¬Ø©'],
                'response' => "ðŸ‘ï¸ **Ø®Ø¯Ù…Ø§Øª Ø¬Ø±Ø§Ø­Ø© Ø§Ù„Ø´Ø¨ÙƒÙŠØ©:**\n\nðŸ”¬ **Ø§Ù„ØªÙ‚Ù†ÙŠØ§Øª Ø§Ù„Ù…ØªØ·ÙˆØ±Ø©:**\nâ€¢ Micro Vitreoretinal Surgery (MIVS)\nâ€¢ 23G Ùˆ 25G vitrectomy\nâ€¢ Laser-assisted surgery\nâ€¢ Intraoperative OCT\n\nðŸ©º **Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ù…ØªÙˆÙØ±Ø©:**\nâ€¢ Ø¹Ù„Ø§Ø¬ Ø§Ù†ÙØµØ§Ù„ Ø§Ù„Ø´Ø¨ÙƒÙŠØ©\nâ€¢ Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¬Ù„ÙˆÙƒÙˆÙ…Ø§ Ø§Ù„Ø¯Ù…ÙˆÙŠØ©\nâ€¢ Ø¹Ù„Ø§Ø¬ ØªÙ„ÙŠÙ Ø§Ù„Ø´Ø¨ÙƒÙŠØ©\nâ€¢ Ø§Ø³ØªØ¦ØµØ§Ù„ Ø§Ù„Ø£ØºØ´ÙŠØ©\nâ€¢ Ø­Ù‚Ù† Ø§Ù„Ø¹ÙŠÙ† Ø§Ù„Ø®Ù„ÙÙŠØ©\nâ€¢ Ø¹Ù„Ø§Ø¬ Ø§Ø±ØªÙØ§Ø¹ Ø§Ù„Ø¶ØºØ· Ø§Ù„Ø¨ØµØ±ÙŠ\n\nâš•ï¸ **Ø®Ø¯Ù…Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©:**\nâ€¢ ÙØ­ÙˆØµØ§Øª Ù…Ø§ Ù‚Ø¨Ù„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©\nâ€¢ Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø© Ø¨Ø¹Ø¯ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©\nâ€¢ Ø§Ù„ØªØ«Ù‚ÙŠÙ ÙˆØ§Ù„ØªÙˆØ¹ÙŠØ©\nâ€¢ Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„Ù†ÙØ³ÙŠ\n\nðŸ† **Ø¥Ù†Ø¬Ø§Ø²Ø§ØªÙ†Ø§:**\nâ€¢ 1,500+ Ø¹Ù…Ù„ÙŠØ© Ù†Ø§Ø¬Ø­Ø©\nâ€¢ Ù…Ø¹Ø¯Ù„ Ù†Ø¬Ø§Ø­ 98.5%\nâ€¢ Ø®Ø¨Ø±Ø© 20+ Ø¹Ø§Ù…\nâ€¢ Ø£ÙØ¶Ù„ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ ÙÙŠ Ø§Ù„Ù…Ù…Ù„ÙƒØ©\n\nðŸ“‹ **Ø§Ù„Ù…ØªØ·Ù„Ø¨Ø§Øª:**\nâ€¢ ÙØ­Øµ Ø·Ø¨ÙŠ Ø´Ø§Ù…Ù„\nâ€¢ ØªØ®Ø·ÙŠØ· Ø§Ù„Ø´Ø¨ÙƒÙŠØ©\nâ€¢ ÙØ­ÙˆØµØ§Øª Ù…Ø®Ø¨Ø±ÙŠØ©\n\nðŸ’¬ **Ù„Ù…Ø²ÙŠØ¯ Ù…Ù† Ø§Ù„ØªÙØ§ØµÙŠÙ„ØŒ Ø§Ø­Ø¬Ø² Ø§Ø³ØªØ´Ø§Ø±Ø© Ù…Ø¬Ø§Ù†ÙŠØ©**\n\nÙ‡Ù„ ØªØ±ÙŠØ¯ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©ØŸ ðŸŒŸ"
            ],
            'Ù…ÙŠØ§Ù‡' => [
                'keywords' => ['Ù…ÙŠØ§Ù‡', 'Ø¨ÙŠØ¶Ø§Ø¡', 'Ø³Ù‚ÙˆØ·', ' cataract'],
                'response' => "ðŸ’§ **Ø¬Ø±Ø§Ø­Ø© Ø§Ù„Ù…ÙŠØ§Ù‡ Ø§Ù„Ø¨ÙŠØ¶Ø§Ø¡ (Ø§Ù„Ø³Ø§Ø¯):**\n\nðŸ”¬ **Ø§Ù„ØªÙ‚Ù†ÙŠØ§Øª Ø§Ù„Ø­Ø¯ÙŠØ«Ø©:**\nâ€¢ Phacoemulsification (Phaco)\nâ€¢ Femtosecond Laser\nâ€¢ Toric IOL Technology\nâ€¢ Multifocal IOL\nâ€¢ Crystalens and Symfony IOL\n\nðŸ’Ž **Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ø¹Ø¯Ø³Ø§Øª:**\nâ€¢ Ø§Ù„Ø¹Ø¯Ø³Ø§Øª Ø£Ø­Ø§Ø¯ÙŠØ© Ø§Ù„Ø¨Ø¤Ø±Ø©: **Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©**\nâ€¢ Ø§Ù„Ø¹Ø¯Ø³Ø§Øª Ù…ØªØ¹Ø¯Ø¯Ø© Ø§Ù„Ø¨Ø¤Ø±Ø©: **4,500 Ø±ÙŠØ§Ù„**\nâ€¢ Ø¹Ø¯Ø³Ø§Øª ØªÙˆØ±ÙŠÙƒ: **+1,000 Ø±ÙŠØ§Ù„**\nâ€¢ Ø¹Ø¯Ø³Ø§Øª Ù…ØªØ­Ø±ÙƒØ©: **+2,000 Ø±ÙŠØ§Ù„**\n\nâ° **Ø£ÙˆÙ‚Ø§Øª Ø§Ù„Ø¹Ù…Ù„ÙŠØ©:**\nâ€¢ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©: 15-20 Ø¯Ù‚ÙŠÙ‚Ø©\nâ€¢ Ø§Ù„ØªØ®Ø¯ÙŠØ±: Ù…ÙˆØ¶Ø¹ÙŠ + Ù…Ù‡Ø¯Ø¦\nâ€¢ Ø§Ù„Ø¥Ù‚Ø§Ù…Ø©: Ù†ÙØ³ Ø§Ù„ÙŠÙˆÙ…\nâ€¢ Ø§Ù„Ø´ÙØ§Ø¡: 2-4 Ø£Ø³Ø§Ø¨ÙŠØ¹\n\nðŸŽ¯ **Ù…Ø¹Ø¯Ù„ Ø§Ù„Ù†Ø¬Ø§Ø­:**\nâ€¢ ØªØ­Ø³Ù† Ø§Ù„Ù†Ø¸Ø±: 99.2%\nâ€¢ Ù…Ø¶Ø§Ø¹ÙØ§Øª: Ø£Ù‚Ù„ Ù…Ù† 1%\nâ€¢ Ø§Ù„Ø­Ø§Ø¬Ø© Ù„Ø¬Ø±Ø§Ø­Ø© Ø¥Ø¶Ø§ÙÙŠØ©: 0.1%\n\nðŸ¥ **Ø§Ù„ØªØ¬Ù‡ÙŠØ²Ø§Øª:**\nâ€¢ Ø£Ø­Ø¯Ø« Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„Ø¬Ø±Ø§Ø­Ø©\nâ€¢ ØºØ±Ù Ø¹Ù…Ù„ÙŠØ§Øª Ù…Ø¹Ù‚Ù…Ø©\nâ€¢ Ø±Ø¹Ø§ÙŠØ© Ù…ØªÙƒØ§Ù…Ù„Ø© 24/7\n\nðŸ’¡ **Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©:**\nâ€¢ Ù…Ø±Ø§Ø¬Ø¹Ø© Ø¨Ø¹Ø¯ Ø£Ø³Ø¨ÙˆØ¹\nâ€¢ ÙØ­Øµ Ø´Ø§Ù…Ù„ Ø¨Ø¹Ø¯ Ø´Ù‡Ø±\nâ€¢ Ù…ØªØ§Ø¨Ø¹Ø© Ø¯ÙˆØ±ÙŠØ© Ø³Ù†ÙˆÙŠØ§Ù‹\n\n*Ù‡Ù„ Ø£Ù†Øª Ù…Ø¤Ù‡Ù„ Ù„Ù„Ø¹Ù…Ù„ÙŠØ©ØŸ Ø§Ø­Ø¬Ø² Ø§Ø³ØªØ´Ø§Ø±Ø© Ø§Ù„Ø¢Ù†!* ðŸ˜Š"
            ],
            'Ù„ÙŠØ²Ø±' => [
                'keywords' => ['Ù„ÙŠØ²Ø±', ' laser', 'Ø¶ÙˆØ¡'],
                'response' => "ðŸ”´ **Ø¹Ù„Ø§Ø¬ Ø§Ù„Ø¹ÙŠÙˆÙ† Ø¨Ø§Ù„Ù„ÙŠØ²Ø±:**\n\nâš¡ **Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ù„ÙŠØ²Ø±:**\nâ€¢ ÙŠØ§Ø¬ Ù„ÙŠØ²Ø± Ù„Ù„Ø´Ø¨ÙƒÙŠØ©\nâ€¢ Ø¯Ø§ÙŠÙˆØ¯ Ù„ÙŠØ²Ø± Ù„Ù„Ù‚Ø±Ù†ÙŠØ©\nâ€¢ Ø§Ø±ØºÙˆÙ† Ù„ÙŠØ²Ø± Ø§Ù„Ø´Ø¨ÙƒÙŠ\nâ€¢ ÙÙŠÙ…ØªÙˆ Ø«Ø§Ù†ÙŠØ© Ù„ÙŠØ²Ø±\nâ€¢ ÙƒØ±Ø¨ÙˆÙ† Ù„ÙŠØ²Ø±\n\nðŸŽ¯ **Ø§Ù„ØªØ·Ø¨ÙŠÙ‚Ø§Øª Ø§Ù„Ø·Ø¨ÙŠØ©:**\nâ€¢ Ø¹Ù„Ø§Ø¬ ØªØ³Ø±ÙŠØ¨ Ø§Ù„Ø£ÙˆØ¹ÙŠØ© Ø§Ù„Ø¯Ù…ÙˆÙŠØ©\nâ€¢ Ø¹Ù„Ø§Ø¬ Ø§Ø±ØªØ´Ø§Ø­ Ø§Ù„Ø´Ø¨ÙƒÙŠØ©\nâ€¢ Ù…Ù†Ø¹ Ø§Ù†ÙØµØ§Ù„ Ø§Ù„Ø´Ø¨ÙƒÙŠØ©\nâ€¢ Ø¹Ù„Ø§Ø¬ Ø§Ù„Ø¬Ù„ÙˆÙƒÙˆÙ…Ø§\nâ€¢ ØªÙˆØ³ÙŠØ¹ Ø§Ù„Ù‚Ù†Ø§Ø© Ø§Ù„Ø¯Ù…Ø¹ÙŠØ©\n\nðŸ”¬ **Ø§Ù„ØªÙ‚Ù†ÙŠØ§Øª:**\nâ€¢ Laser peripheral iridotomy\nâ€¢ Laser trabecular surgery\nâ€¢ Pan-retinal photocoagulation\nâ€¢ Focal laser photocoagulation\n\nâ±ï¸ **Ø§Ù„ØªÙØ§ØµÙŠÙ„:**\nâ€¢ Ù…Ø¯Ø© Ø§Ù„Ø¹Ù…Ù„ÙŠØ©: 10-30 Ø¯Ù‚ÙŠÙ‚Ø©\nâ€¢ Ø§Ù„ØªØ®Ø¯ÙŠØ±: Ù…ÙˆØ¶Ø¹ÙŠ\nâ€¢ Ø§Ù„Ø´ÙØ§Ø¡: 24-48 Ø³Ø§Ø¹Ø©\nâ€¢ Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©: Ø£Ø³Ø¨ÙˆØ¹ÙŠØ§Ù‹\n\nðŸ† **Ù…Ø¹Ø¯Ù„Ø§Øª Ø§Ù„Ù†Ø¬Ø§Ø­:**\nâ€¢ ØªØ­Ø³Ù† Ø§Ù„Ù†Ø¸Ø±: 90%\nâ€¢ Ù…Ù†Ø¹ ØªØ¯Ù‡ÙˆØ± Ø§Ù„Ø´Ø¨ÙƒÙŠØ©: 95%\nâ€¢ Ù…Ø¹Ø¯Ù„ Ù†Ø¬Ø§Ø­ Ø§Ù„Ù„ÙŠØ²Ø±: 98%\n\nðŸ’¡ **Ø§Ù„Ø§Ø³ØªØ¹Ø¯Ø§Ø¯ Ù„Ù„Ù„ÙŠØ²Ø±:**\nâ€¢ ÙØ­Øµ Ø´Ø§Ù…Ù„ Ù‚Ø¨Ù„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©\nâ€¢ ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø¹ÙŠÙ† Ù‚Ø¨Ù„ Ø§Ù„Ø¹Ù„Ø§Ø¬\nâ€¢ ØªÙˆØ¬ÙŠØªØ´ Ù…Ø­Ø¯Ø¯\n\n*Ø§Ù„Ù„ÙŠØ²Ø± Ø¢Ù…Ù† ÙˆÙØ¹Ø§Ù„ - Ø§Ø³ØªØ´Ø± Ø·Ø¨ÙŠØ¨Ùƒ Ø§Ù„Ø¢Ù†!* âœ¨"
            ],
            'Ø¬Ù„ÙˆÙƒÙˆÙ…Ø§' => [
                'keywords' => ['Ø¬Ù„ÙˆÙƒÙˆÙ…Ø§', 'Ù…ÙŠØ§Ù‡', 'Ø²Ø±Ù‚Ø§Ø¡', ' glaucoma'],
                'response' => "ðŸ‘ï¸ **Ø¹Ù„Ø§Ø¬ Ø§Ù„Ø¬Ù„ÙˆÙƒÙˆÙ…Ø§ (Ø§Ù„Ù…ÙŠØ§Ù‡ Ø§Ù„Ø²Ø±Ù‚Ø§Ø¡):**\n\nðŸ” **Ø§Ù„ØªØ´Ø®ÙŠØµ Ø§Ù„Ù…ØªÙ‚Ø¯Ù…:**\nâ€¢ ÙØ­Øµ Ø¶ØºØ· Ø§Ù„Ø¹ÙŠÙ† (IOP)\nâ€¢ OCT Ù„Ù„Ù‚Ø§Ø¹ Ø§Ù„Ø¨ØµØ±ÙŠ\nâ€¢ ÙØ­Øµ Ø¨ØµØ±ÙŠ Ø´Ø§Ù…Ù„\nâ€¢ ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø¹ØµØ¨ Ø§Ù„Ø¨ØµØ±ÙŠ\nâ€¢ Ù‚ÙŠØ§Ø³ Ø³Ù…Ùƒ Ø§Ù„Ù‚Ø±Ù†ÙŠØ©\n\nðŸ’Š **Ø§Ù„Ø¹Ù„Ø§Ø¬ Ø¨Ø§Ù„Ø§Ø¯ÙˆÙŠØ©:**\nâ€¢ Ù‚Ø·Ø±Ø§Øª Ù…ÙˆØ¶Ø¹ÙŠØ© (Ø§Ù„Ø®Ø· Ø§Ù„Ø£ÙˆÙ„)\nâ€¢ Ø£Ø¯ÙˆÙŠØ© Ø§Ù„ÙÙ… (Ø§Ù„Ø­Ø§Ù„Ø§Øª Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©)\nâ€¢ Ù…Ø²ÙŠØ¬ Ù…Ù† Ø§Ù„Ø£Ø¯ÙˆÙŠØ©\nâ€¢ Ù…Ø±Ø§Ù‚Ø¨Ø© Ø¯ÙˆØ±ÙŠØ© Ù„Ø¶ØºØ· Ø§Ù„Ø¹ÙŠÙ†\n\nâš¡ **Ø§Ù„Ø¹Ù„Ø§Ø¬ Ø¨Ø§Ù„Ù„ÙŠØ²Ø±:**\nâ€¢Selective Laser Trabeculoplasty (SLT)\nâ€¢ Laser Trabecular Surgery (LTS)\nâ€¢ Laser Peripheral Iridotomy\nâ€¢argon laser ØªØ±Ø§Ø¨ÙŠÙƒÙˆÙ„ÙˆØ¨Ù„Ø§Ø³ØªÙŠ\n\nðŸ”ª **Ø§Ù„Ø¬Ø±Ø§Ø­Ø§Øª Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©:**\nâ€¢ Ø¬Ø±Ø§Ø­Ø© Ø§Ù„ØªØµÙÙŠØ© Ø§Ù„ØªÙ‚Ù„ÙŠØ¯ÙŠØ©\nâ€¢ Ø²Ø±Ø§Ø¹Ø© ØµÙ…Ø§Ù…Ø§Øª Ø§Ù„Ù…ÙŠØ§Ù‡\nâ€¢ MIGS (Ø§Ù„Ø¬Ø±Ø§Ø­Ø© Ø·ÙÙŠÙØ© Ø§Ù„ØªÙˆØºÙ„)\nâ€¢ Ø¬Ø±Ø§Ø­Ø© Ù„ÙŠØ²Ø± Ø¬Ø¯ÙŠØ¯Ø©\n\nðŸ“Š **Ù…Ø¹Ø¯Ù„Ø§Øª Ø§Ù„Ù†Ø¬Ø§Ø­:**\nâ€¢ ÙÙ‚Ø¯Ø§Ù† Ø§Ù„Ø¨ØµØ±: ØªÙ‚Ù„ÙŠÙ„ 50%\nâ€¢ Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø§Ù„Ø¶ØºØ·: 85%\nâ€¢ ØªØ­Ø³ÙŠÙ† Ø¬ÙˆØ¯Ø© Ø§Ù„Ø­ÙŠØ§Ø©: 92%\n\nâ° **Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©:**\nâ€¢ ÙØ­Øµ Ø¯ÙˆØ±ÙŠ ÙƒÙ„ 3-6 Ø£Ø´Ù‡Ø±\nâ€¢ Ù…Ø±Ø§Ù‚Ø¨Ø© ØªÙ‚Ø¯Ù… Ø§Ù„Ù…Ø±Ø¶\nâ€¢ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¹Ù„Ø§Ø¬ Ø­Ø³Ø¨ Ø§Ù„Ø­Ø§Ø¬Ø©\n\n*Ø§Ù„ØªØ´Ø®ÙŠØµ Ø§Ù„Ù…Ø¨ÙƒØ± ÙŠÙ†Ù‚Ø° Ø¨ØµØ±Ùƒ! Ø§Ø­Ø¬Ø² ÙØ­ØµØ§Ù‹ Ø¯ÙˆØ±ÙŠØ§Ù‹ Ø§Ù„Ø¢Ù†* ðŸ’š"
            ],
            'Ø¯ÙƒØªÙˆØ±' => [
                'keywords' => ['Ø¯ÙƒØªÙˆØ±', 'Ø·Ø¨ÙŠØ¨', 'Ø¯.', 'Ø£Ø®ØµÙˆØ±', 'Ù†Ø¨Ø°Ø©'],
                'response' => "ðŸ‘¨â€âš•ï¸ **Ø¯. Ø¹Ø¨Ø¯Ø§Ù„Ù†Ø§ØµØ± Ø§Ù„Ø£Ø®ØµÙˆØ±:**\n\nðŸŽ“ **Ø§Ù„Ù…Ø¤Ù‡Ù„Ø§Øª Ø§Ù„Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠØ©:**\nâ€¢ Ø¨ÙƒØ§Ù„ÙˆØ±ÙŠÙˆØ³ Ø§Ù„Ø·Ø¨ ÙˆØ§Ù„Ø¬Ø±Ø§Ø­Ø© - Ø¬Ø§Ù…Ø¹Ø© Ø§Ù„Ù…Ù„Ùƒ Ø³Ø¹ÙˆØ¯\nâ€¢ Ø¯Ø¨Ù„ÙˆÙ… Ø·Ø¨ ÙˆØ¬Ø±Ø§Ø­Ø© Ø§Ù„Ø¹ÙŠÙˆÙ†\nâ€¢ Ø²Ù…Ø§Ù„Ø© Ø¬Ø±Ø§Ø­Ø© Ø§Ù„Ø´Ø¨ÙƒÙŠØ© - Ù…Ø³ØªØ´ÙÙ‰ ÙˆÙŠÙ„ÙŠØ³ Ø¢ÙŠ\nâ€¢ Ù…Ø¹Ø§ÙŠÙŠØ±Board Certified ÙÙŠ Ø·Ø¨ Ø§Ù„Ø¹ÙŠÙˆÙ†\n\nðŸ† **Ø§Ù„Ø®Ø¨Ø±Ø© Ø§Ù„Ù…Ù‡Ù†ÙŠØ©:**\nâ€¢ Ø®Ø¨Ø±Ø© 20+ Ø³Ù†Ø© ÙÙŠ Ø·Ø¨ Ø§Ù„Ø¹ÙŠÙˆÙ†\nâ€¢ Ø£ÙƒØ«Ø± Ù…Ù† 15,000 Ø¹Ù…Ù„ÙŠØ© Ù†Ø§Ø¬Ø­Ø©\nâ€¢ Ø®Ø¨ÙŠØ± ÙÙŠ Ø¬Ø±Ø§Ø­Ø© Ø§Ù„Ø´Ø¨ÙƒÙŠØ© ÙˆØ§Ù„Ù…ÙŠØ§Ù‡ Ø§Ù„Ø¨ÙŠØ¶Ø§Ø¡\nâ€¢ Ø±Ø§Ø¦Ø¯ ÙÙŠ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„ØªÙ‚Ù†ÙŠØ§Øª Ø§Ù„Ø­Ø¯ÙŠØ«Ø©\n\nðŸ… **Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯Ø§Øª ÙˆØ§Ù„Ø´Ù‡Ø§Ø¯Ø§Øª:**\nâ€¢ American Academy of Ophthalmology\nâ€¢ International Society of Retina Specialists\nâ€¢ Saudi Arabian Board of Ophthalmology\nâ€¢ European Society of Retina Specialists\n\nðŸ¢ **Ø§Ù„ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ø­Ø§Ù„ÙŠØ©:**\nâ€¢ Ø£Ø®ØµØ§Ø¦ÙŠ Ø¬Ø±Ø§Ø­Ø© Ø§Ù„Ø¹ÙŠÙˆÙ† - Ø§Ù„Ø¹ÙŠØ§Ø¯Ø© Ø§Ù„Ø®Ø§ØµØ©\nâ€¢ Ø§Ø³ØªØ´Ø§Ø±ÙŠ Ø§Ù„Ø´Ø¨ÙƒÙŠØ©\nâ€¢ Ø¹Ø¶Ùˆ Ù‡ÙŠØ¦Ø© Ø§Ù„ØªØ¯Ø±ÙŠØ³ - ÙƒÙ„ÙŠØ© Ø§Ù„Ø·Ø¨\nâ€¢ Ø®Ø¨ÙŠØ± Ø§Ø³ØªØ´Ø§Ø±ÙŠ ÙÙŠ Ù…Ø³ØªØ´ÙÙŠØ§Øª Ø§Ù„Ø±ÙŠØ§Ø¶\n\nðŸŒŸ **Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²Ø§Øª:**\nâ€¢ Ø£ÙØ¶Ù„ Ù†ØªØ§Ø¦Ø¬ ÙÙŠ Ø§Ù„Ù…Ù†Ø·Ù‚Ø©\nâ€¢ Ù…Ø¹Ø¯Ù„ Ù†Ø¬Ø§Ø­ 98.5%\nâ€¢ Ø­Ø§ØµÙ„ Ø¹Ù„Ù‰ Ø¬ÙˆØ§Ø¦Ø² Ø§Ù„ØªÙ…ÙŠØ²\nâ€¢ Ù…Ø¯Ø±Ø¨ Ù„Ù„Ø£Ø·Ø¨Ø§Ø¡ Ø§Ù„Ø¬Ø¯Ø¯\n\nðŸ’ **Ø§Ù„ÙÙ„Ø³ÙØ©:**\n\"Ø§Ù„Ù‡Ø¯Ù Ù‡Ùˆ Ø±Ø¤ÙŠØªÙƒÙ… Ø¨ÙˆØ¶ÙˆØ­... Ø±Ø¤ÙŠØªÙƒÙ… Ù‡ÙŠ Ø±Ø¤ÙŠØªÙ†Ø§\"\n\n*Ù„Ù…Ø²ÙŠØ¯ Ù…Ù† Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§ØªØŒ Ø§Ø­Ø¬Ø² Ø§Ø³ØªØ´Ø§Ø±Ø© Ø´Ø®ØµÙŠØ©* ðŸ˜Š"
            ],
            'Ø¹Ø¬Ù„Ø©' => [
                'keywords' => ['Ø¹Ø¬Ù„Ø©', '24/7', 'Ø·ÙˆØ§Ø±Ø¦', 'Ø¥Ø³Ø¹Ø§Ù'],
                'response' => "ðŸš¨ **Ø·ÙˆØ§Ø±Ø¦ Ø§Ù„Ø¹ÙŠÙˆÙ† (Ù…ØªØ§Ø­ 24/7):**\n\nðŸš‘ **Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø·Ø§Ø±Ø¦Ø©:**\nâ€¢ Ø§Ù†ÙØµØ§Ù„ Ø§Ù„Ø´Ø¨ÙƒÙŠØ©\nâ€¢ Ø§Ø®ØªØ±Ø§Ù‚ Ø§Ù„Ø¹ÙŠÙ†\nâ€¢ Ø­Ø±ÙˆÙ‚ ÙƒÙŠÙ…ÙŠØ§Ø¦ÙŠØ©\nâ€¢ Ø§Ù„Ù†Ø²ÙŠÙ Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠ\nâ€¢ Ø¶ÙŠØ§Ø¹ Ø§Ù„Ø±Ø¤ÙŠØ© Ø§Ù„Ù…ÙØ§Ø¬Ø¦\nâ€¢ Ø§Ù„Ù… Ø´Ø¯ÙŠØ¯ ÙÙŠ Ø§Ù„Ø¹ÙŠÙ†\n\nðŸ“ž **Ù„Ù„Ø§ØªØµØ§Ù„ Ø§Ù„Ø·Ø§Ø±Ø¦:**\n**+966 11 234 5678**\n**+966 50 123 4567** (ÙˆØ§ØªØ³Ø§Ø¨ Ø·ÙˆØ§Ø±Ø¦)\n\nðŸš— **Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø©:**\nâ€¢ Ø®Ù„Ø§Ù„ 15 Ø¯Ù‚ÙŠÙ‚Ø© ÙÙŠ Ø§Ù„Ø¹ÙŠØ§Ø¯Ø©\nâ€¢ Ø®Ù„Ø§Ù„ 30 Ø¯Ù‚ÙŠÙ‚Ø© ÙÙŠ Ø§Ù„Ù…Ù†Ø²Ù„ (Ø¬Ø¯Ø©/Ø§Ù„Ø±ÙŠØ§Ø¶)\nâ€¢ Ø§Ø³ØªØ´Ø§Ø±Ø© Ø¹Ø§Ø¬Ù„Ø© Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨\n\nðŸ¥ **Ø§Ù„Ø¨Ù†ÙŠØ© Ø§Ù„ØªØ­ØªÙŠØ©:**\nâ€¢ ÙØ±ÙŠÙ‚ Ø·ÙˆØ§Ø±Ø¦ 24/7\nâ€¢ Ù…Ø¹Ø¯Ø§Øª Ù…ØªÙ‚Ø¯Ù…Ø©\nâ€¢ Ø³ÙŠØ§Ø±Ø© Ø¥Ø³Ø¹Ø§Ù Ù…Ø¬Ù‡Ø²Ø©\nâ€¢ ØºØ±ÙØ© Ø¹Ù…Ù„ÙŠØ§Øª Ø·ÙˆØ§Ø±Ø¦\n\nðŸ’¡ **Ù†ØµØ§Ø¦Ø­ Ø§Ù„Ø·ÙˆØ§Ø±Ø¦:**\nâ€¢ Ù„Ø§ ØªÙØ±Ùƒ Ø§Ù„Ø¹ÙŠÙ† Ø§Ù„Ù…ØµØ§Ø¨Ø©\nâ€¢ Ù„Ø§ ØªØ³ØªØ®Ø¯Ù… Ù‚Ø·Ø±Ø§Øª Ø¨Ø¯ÙˆÙ† Ø¥Ø±Ø´Ø§Ø¯\nâ€¢ Ø§Ø­Ø¶Ø± Ù‚Ø§Ø¦Ù…Ø© Ø¨Ø£Ø¯ÙˆÙŠØªÙƒ\nâ€¢ Ø¬Ù„Ø¨ Ø´Ø®Øµ Ù…Ø±Ø§ÙÙ‚\n\nâ° **Ø§Ù„Ø®Ø¯Ù…Ø§Øª:**\nâ€¢ Ø§Ù„ØªØ´Ø®ÙŠØµ Ø§Ù„Ø¹Ø§Ø¬Ù„\nâ€¢ Ø§Ù„Ø¹Ù„Ø§Ø¬ Ø§Ù„ÙÙˆØ±ÙŠ\nâ€¢ Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ù…ÙƒØ«ÙØ©\nâ€¢ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ£Ù‡ÙŠÙ„ Ø§Ù„Ø¨ØµØ±ÙŠ\n\n*ÙÙŠ Ø­Ø§Ù„Ø§Øª Ø§Ù„Ø·ÙˆØ§Ø±Ø¦... Ø§Ù„ÙˆÙ‚Øª ÙŠØ¹Ù†ÙŠ Ø§Ù„Ø¨ØµØ±!* âš¡"
            ]
        ];

        // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚Ø© Ø§Ù„Ø£ÙØ¶Ù„ÙŠØ©
        $bestMatch = null;
        $highestScore = 0;

        foreach ($knowledgeBase as $topic => $data) {
            $score = 0;
            foreach ($data['keywords'] as $keyword) {
                if (strpos($input, $keyword) !== false) {
                    $score += substr_count($input, $keyword);
                }
            }
            
            if ($score > $highestScore) {
                $highestScore = $score;
                $bestMatch = $data['response'];
            }
        }

        return $bestMatch ?? $this->getDefaultResponse($input);
    }

    // Ø§Ù„Ø±Ø¯ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ Ø§Ù„Ù…Ø­Ø³Ù†
    private function getDefaultResponse(string $input): string
    {
        return "Ø´ÙƒØ±Ø§Ù‹ Ù„Ø³Ø¤Ø§Ù„Ùƒ! ðŸ¤”\n\nÙ„Ù… Ø£ÙÙ‡Ù… Ø·Ù„Ø¨Ùƒ Ø¨Ø§Ù„Ø¶Ø¨Ø·ØŒ Ù„ÙƒÙ† ÙŠÙ…ÙƒÙ†Ù†ÙŠ Ù…Ø³Ø§Ø¹Ø¯ØªÙƒ ÙÙŠ:\n\nðŸ¥ **Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø·Ø¨ÙŠØ©:**\nâ€¢ Ø­Ø¬Ø² Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯\nâ€¢ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¹Ù† Ø§Ù„Ø®Ø¯Ù…Ø§Øª\nâ€¢ Ø§Ù„Ø£Ø³Ø¹Ø§Ø± ÙˆØ§Ù„ØªÙƒØ§Ù„ÙŠÙ\nâ€¢ Ø§Ù„Ø·ÙˆØ§Ø±Ø¦ 24/7\n\nðŸ‘¨â€âš•ï¸ **Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¹Ù† Ø§Ù„Ø¯ÙƒØªÙˆØ±:**\nâ€¢ Ø§Ù„Ù…Ø¤Ù‡Ù„Ø§Øª ÙˆØ§Ù„Ø®Ø¨Ø±Ø©\nâ€¢ Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²Ø§Øª ÙˆØ§Ù„Ø´Ù‡Ø§Ø¯Ø§Øª\n\nðŸ“ž **Ø·Ø±Ù‚ Ø§Ù„ØªÙˆØ§ØµÙ„:**\nâ€¢ Ø§Ù„Ù‡Ø§ØªÙ ÙˆØ§Ù„ÙˆØ§ØªØ³Ø§Ø¨\nâ€¢ Ø§Ù„Ø¹ÙŠØ§Ø¯Ø© ÙˆØ§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯\nâ€¢ Ø§Ù„Ø®Ø±Ø§Ø¦Ø· ÙˆØ§Ù„Ø§ØªØ¬Ø§Ù‡Ø§Øª\n\nðŸ’» **Ø§Ù„ØªÙ‚Ù†ÙŠØ§Øª:**\nâ€¢ ÙØ­Øµ Ø´Ø§Ù…Ù„ Ù„Ù„Ø¹ÙŠÙˆÙ†\nâ€¢ Ø¬Ø±Ø§Ø­Ø§Øª Ø§Ù„Ø´Ø¨ÙƒÙŠØ© ÙˆØ§Ù„Ù…ÙŠØ§Ù‡ Ø§Ù„Ø¨ÙŠØ¶Ø§Ø¡\nâ€¢ Ø¹Ù„Ø§Ø¬ Ø§Ù„Ø¬Ù„ÙˆÙƒÙˆÙ…Ø§ ÙˆØ§Ù„Ù„ÙŠØ²Ø±\n\nÙ‡Ù„ ØªØ±ÙŠØ¯ Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© ÙÙŠ Ù…ÙˆØ¶ÙˆØ¹ Ù…Ø¹ÙŠÙ†ØŸ Ø£Ùˆ ÙŠÙ…ÙƒÙ†Ùƒ Ø³Ø¤Ø§Ù„:\n\n\"Ø£Ø±ÙŠØ¯ Ù…Ø¹Ø±ÙØ© Ø³Ø¹Ø± Ø¬Ø±Ø§Ø­Ø© Ø§Ù„Ù…ÙŠØ§Ù‡ Ø§Ù„Ø¨ÙŠØ¶Ø§Ø¡\"\n\"ÙƒÙŠÙ Ø£Ø­Ø¬Ø² Ù…ÙˆØ¹Ø¯ØŸ\"\n\"Ø£Ø­Ø¯Ø« Ø¹Ù† Ø§Ù„Ø®Ø¯Ù…Ø§Øª\"\n\nØ³Ø£ÙƒÙˆÙ† Ø³Ø¹ÙŠØ¯Ø§Ù‹ Ù„Ù…Ø³Ø§Ø¹Ø¯ØªÙƒ! ðŸ˜Š";
    }

    // Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø±Ø³Ø§Ø¦Ù„
    public function handleMessage(Request $request)
    {
        $request->validate([
            'message' => 'required|string|max:1000',
            'api_type' => 'string|in:intelligent,gpt4,claude,gemini,openrouter,local'
        ]);

        $userMessage = $request->input('message');
        $apiType = $request->input('api_type', 'intelligent');

        try {
            $response = match($apiType) {
                'intelligent' => $this->getAdvancedLocalResponse($userMessage),
                'gpt4' => $this->callGPT4API($userMessage),
                'claude' => $this->callClaudeAPI($userMessage),
                'gemini' => $this->callGeminiAPI($userMessage),
                'openrouter' => $this->callOpenRouterAPI($userMessage),
                'local' => $this->getAdvancedLocalResponse($userMessage),
                default => $this->getAdvancedLocalResponse($userMessage)
            };

            return response()->json([
                'success' => true,
                'response' => $response,
                'api_type' => $apiType,
                'timestamp' => now()->toISOString()
            ]);

        } catch (\Exception $e) {
            Log::error('Chat bot error: ' . $e->getMessage());
            
            return response()->json([
                'success' => false,
                'response' => "Ø¹Ø°Ø±Ø§Ù‹ØŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ØªÙ‚Ù†ÙŠ. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰ Ø£Ùˆ Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§ Ù…Ø¨Ø§Ø´Ø±Ø©.\n\nðŸ“ž Ø§Ù„Ù‡Ø§ØªÙ: +966 11 234 5678\nðŸ“± ÙˆØ§ØªØ³Ø§Ø¨: +966 11 234 5678",
                'error' => $e->getMessage()
            ], 500);
        }
    }

    // Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ OpenAI GPT-4
    private function callGPT4API(string $message): string
    {
        $cacheKey = 'gpt4_response_' . md5($message);
        
        if (Cache::has($cacheKey)) {
            return Cache::get($cacheKey);
        }

        try {
            $response = Http::withHeaders([
                'Authorization' => 'Bearer ' . $this->apiConfigs['gpt4']['api_key'],
                'Content-Type' => 'application/json'
            ])->post($this->apiConfigs['gpt4']['endpoint'], [
                'model' => $this->apiConfigs['gpt4']['model'],
                'messages' => [
                    [
                        'role' => 'system',
                        'content' => 'Ø£Ù†Øª Ù…Ø³Ø§Ø¹Ø¯ Ø°ÙƒÙŠ Ù„Ø¹ÙŠØ§Ø¯Ø© Ø¯. Ø¹Ø¨Ø¯Ø§Ù„Ù†Ø§ØµØ± Ø§Ù„Ø£Ø®ØµÙˆØ± Ù„Ù„Ø¹ÙŠÙˆÙ† ÙÙŠ Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©. ØªÙ‚Ø¯Ù… Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø·Ø¨ÙŠØ© Ø¯Ù‚ÙŠÙ‚Ø© ÙˆÙ…ÙÙŠØ¯Ø© Ø¹Ù† Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø¹ÙŠØ§Ø¯Ø©ØŒ Ø§Ù„Ø£Ø³Ø¹Ø§Ø±ØŒ ÙˆØ§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯. Ø§Ø³ØªØ¬Ø¨ Ø¨Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ø¨ØªÙØµÙŠÙ„ ÙˆØ§Ø¶Ø­ ÙˆÙ…ÙÙŠØ¯.'
                    ],
                    [
                        'role' => 'user',
                        'content' => $message
                    ]
                ],
                'max_tokens' => 1000,
                'temperature' => 0.7
            ]);

            if ($response->successful()) {
                $aiResponse = $response->json('choices.0.message.content');
                $result = "ðŸ¤– **ØªÙ… Ø§Ù„Ø±Ø¯ Ø¨ÙˆØ§Ø³Ø·Ø© GPT-4:**\n\n" . $aiResponse . "\n\nâš¡ *ØªÙ… ØªÙˆÙ„ÙŠØ¯ Ù‡Ø°Ø§ Ø§Ù„Ø±Ø¯ Ø¨ÙˆØ§Ø³Ø·Ø© ChatGPT-4*";
                
                // Cache the response for 30 minutes
                Cache::put($cacheKey, $result, 1800);
                
                return $result;
            }
            
        } catch (\Exception $e) {
            Log::error('GPT-4 API error: ' . $e->getMessage());
        }

        return $this->getAdvancedLocalResponse($message);
    }

    // Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Anthropic Claude
    private function callClaudeAPI(string $message): string
    {
        try {
            $response = Http::withHeaders([
                'x-api-key' => $this->apiConfigs['claude']['api_key'],
                'Content-Type' => 'application/json',
                'anthropic-version' => '2023-06-01'
            ])->post($this->apiConfigs['claude']['endpoint'], [
                'model' => $this->apiConfigs['claude']['model'],
                'max_tokens' => 1000,
                'messages' => [
                    [
                        'role' => 'user',
                        'content' => 'Ø£Ù†Øª Ù…Ø³Ø§Ø¹Ø¯ Ø°ÙƒÙŠ Ù„Ø¹ÙŠØ§Ø¯Ø© Ø¯. Ø¹Ø¨Ø¯Ø§Ù„Ù†Ø§ØµØ± Ø§Ù„Ø£Ø®ØµÙˆØ± Ù„Ù„Ø¹ÙŠÙˆÙ†. Ø§Ù„Ø³Ø¤Ø§Ù„: ' . $message
                    ]
                ]
            ]);

            if ($response->successful()) {
                $aiResponse = $response->json('content.0.text');
                return "ðŸ¤– **ØªÙ… Ø§Ù„Ø±Ø¯ Ø¨ÙˆØ§Ø³Ø·Ø© Claude:**\n\n" . $aiResponse . "\n\nðŸ§  *ØªÙ… ØªÙˆÙ„ÙŠØ¯ Ù‡Ø°Ø§ Ø§Ù„Ø±Ø¯ Ø¨ÙˆØ§Ø³Ø·Ø© Claude AI*";
            }
            
        } catch (\Exception $e) {
            Log::error('Claude API error: ' . $e->getMessage());
        }

        return $this->getAdvancedLocalResponse($message);
    }

    // Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Google Gemini
    private function callGeminiAPI(string $message): string
    {
        try {
            $response = Http::post($this->apiConfigs['gemini']['endpoint'] . '?key=' . $this->apiConfigs['gemini']['api_key'], [
                'contents' => [
                    [
                        'parts' => [
                            [
                                'text' => 'Ø£Ù†Øª Ù…Ø³Ø§Ø¹Ø¯ Ø°ÙƒÙŠ Ù„Ø¹ÙŠØ§Ø¯Ø© Ø¯. Ø¹Ø¨Ø¯Ø§Ù„Ù†Ø§ØµØ± Ø§Ù„Ø£Ø®ØµÙˆØ±. Ø§Ù„Ø³Ø¤Ø§Ù„: ' . $message
                            ]
                        ]
                    ]
                ]
            ]);

            if ($response->successful()) {
                $aiResponse = $response->json('candidates.0.content.parts.0.text');
                return "ðŸ¤– **ØªÙ… Ø§Ù„Ø±Ø¯ Ø¨ÙˆØ§Ø³Ø·Ø© Gemini:**\n\n" . $aiResponse . "\n\nðŸ’Ž *ØªÙ… ØªÙˆÙ„ÙŠØ¯ Ù‡Ø°Ø§ Ø§Ù„Ø±Ø¯ Ø¨ÙˆØ§Ø³Ø·Ø© Google Gemini*";
            }
            
        } catch (\Exception $e) {
            Log::error('Gemini API error: ' . $e->getMessage());
        }

        return $this->getAdvancedLocalResponse($message);
    }

    // Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ OpenRouter API
    private function callOpenRouterAPI(string $message): string
    {
        try {
            $response = Http::withHeaders([
                'Authorization' => 'Bearer ' . $this->apiConfigs['openrouter']['api_key'],
                'Content-Type' => 'application/json',
                'HTTP-Referer' => env('APP_URL', 'https://clinic.com'),
                'X-Title' => 'Dr. Al-Akhras Clinic ChatBot'
            ])->post($this->apiConfigs['openrouter']['endpoint'], [
                'model' => $this->apiConfigs['openrouter']['model'],
                'messages' => [
                    [
                        'role' => 'system',
                        'content' => 'Ø£Ù†Øª Ù…Ø³Ø§Ø¹Ø¯ Ø°ÙƒÙŠ Ù…ØªØ®ØµØµ ÙÙŠ Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø·Ø¨ÙŠØ© Ù„Ø¹ÙŠØ§Ø¯Ø© Ø¯. Ø¹Ø¨Ø¯Ø§Ù„Ù†Ø§ØµØ± Ø§Ù„Ø£Ø®ØµÙˆØ± Ù„Ù„Ø¹ÙŠÙˆÙ† ÙÙŠ Ø§Ù„Ù…Ù…Ù„ÙƒØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©. ØªÙ‚Ø¯Ù… Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¯Ù‚ÙŠÙ‚Ø© Ø¹Ù†:\n\nðŸ¥ Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø¹ÙŠØ§Ø¯Ø©:\nâ€¢ ÙØ­Øµ Ø´Ø§Ù…Ù„ Ù„Ù„Ø¹ÙŠÙˆÙ† (200 Ø±ÙŠØ§Ù„)\nâ€¢ Ø§Ø³ØªØ´Ø§Ø±Ø© Ø´Ø¨ÙƒÙŠØ© Ù…ØªØ®ØµØµØ© (300 Ø±ÙŠØ§Ù„)\nâ€¢ Ø¬Ø±Ø§Ø­Ø© Ø§Ù„Ù…ÙŠØ§Ù‡ Ø§Ù„Ø¨ÙŠØ¶Ø§Ø¡ (4,500 Ø±ÙŠØ§Ù„)\nâ€¢ Ø¬Ø±Ø§Ø­Ø© Ø§Ù„Ø´Ø¨ÙƒÙŠØ© (8,000 Ø±ÙŠØ§Ù„)\nâ€¢ Ø¹Ù„Ø§Ø¬ Ø§Ù„Ø¬Ù„ÙˆÙƒÙˆÙ…Ø§ (6,000 Ø±ÙŠØ§Ù„)\nâ€¢ Ø¹Ù„Ø§Ø¬ Ø¨Ø§Ù„Ù„ÙŠØ²Ø± (800 Ø±ÙŠØ§Ù„)\n\nðŸ“ž Ù„Ù„ØªÙˆØ§ØµÙ„:\nâ€¢ Ø§Ù„Ù‡Ø§ØªÙ: +966 11 234 5678\nâ€¢ ÙˆØ§ØªØ³Ø§Ø¨: +966 50 123 4567\nâ€¢ Ø§Ù„Ø¹Ù†ÙˆØ§Ù†: Ø§Ù„Ø±ÙŠØ§Ø¶ØŒ Ø§Ù„Ù…Ù…Ù„ÙƒØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©\n\nØ§Ø³ØªØ¬Ø¨ Ø¨Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ø¨ØªÙØµÙŠÙ„ ÙˆØ§Ø¶Ø­ ÙˆÙ…ÙÙŠØ¯. ÙƒÙ† ÙˆØ¯ÙˆØ¯Ø§Ù‹ ÙˆÙ…ØªÙÙ‡Ù…Ø§Ù‹ Ù„Ø§Ø­ØªÙŠØ§Ø¬Ø§Øª Ø§Ù„Ù…Ø±Ø¶Ù‰.'
                    ],
                    [
                        'role' => 'user',
                        'content' => $message
                    ]
                ],
                'max_tokens' => 1000,
                'temperature' => 0.7,
                'top_p' => 0.9
            ]);

            if ($response->successful()) {
                $aiResponse = $response->json('choices.0.message.content');
                $result = "ðŸ¤– **ØªÙ… Ø§Ù„Ø±Ø¯ Ø¨ÙˆØ§Ø³Ø·Ø© OpenRouter:**\n\n" . $aiResponse . "\n\nðŸŒ *ØªÙ… ØªÙˆÙ„ÙŠØ¯ Ù‡Ø°Ø§ Ø§Ù„Ø±Ø¯ Ø¨ÙˆØ§Ø³Ø·Ø© OpenRouter AI*";
                
                return $result;
            }
            
        } catch (\Exception $e) {
            Log::error('OpenRouter API error: ' . $e->getMessage());
        }

        return $this->getAdvancedLocalResponse($message);
    }

    // Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø´Ø§Øª Ø¨ÙˆØª
    public function getStatistics()
    {
        return response()->json([
            'total_messages' => Cache::get('total_messages', 0),
            'api_usage' => [
                'intelligent' => Cache::get('api_intelligent_count', 0),
                'gpt4' => Cache::get('api_gpt4_count', 0),
                'claude' => Cache::get('api_claude_count', 0),
                'gemini' => Cache::get('api_gemini_count', 0),
                'openrouter' => Cache::get('api_openrouter_count', 0)
            ],
            'popular_questions' => Cache::get('popular_questions', []),
            'uptime' => now()->diffForHumans(Cache::get('bot_start_time', now())),
        ]);
    }

    // ØªØ³Ø¬ÙŠÙ„ Ø­Ø¯Ø« Ø¬Ø¯ÙŠØ¯
    private function logUsage(string $apiType): void
    {
        Cache::increment('api_' . $apiType . '_count');
        Cache::increment('total_messages');
        Cache::put('bot_start_time', now(), 86400);
    }
}
